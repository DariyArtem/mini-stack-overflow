document.addEventListener('DOMContentLoaded', function () {
    let questions = [
        {
            question: 'What is PHP?',
            description: "PHP is a programming language for Server side of web application",
            category: 'php'
        },
        {
            question: 'What is JavaScript?',
            description: "JavaScript is a programming language for Client side of web application",
            category: 'js'
        }
    ];

    function db_loadQuestions(key) {
        let db = localStorage.getItem(key);
        if (db === null) {
            return false;
        }
        return questions = JSON.parse(db);
    }

    function db_saveQuestions(data,key) {
        let db = JSON.parse(localStorage.getItem(key));
        db.push(data);
        localStorage.setItem(key, JSON.stringify(db));
    }


    function renderQuestions() {
        let view = '';
        let parsedQuestions = db_loadQuestions('db');
        parsedQuestions.forEach(item => {
                view += `<div>
                              <div class="problem">
                                  <dt class="question">${item.question}</dt>
                                  <button class="open-question">Open this question</button>
                                  <dd class="decs">${item.description}</dd>
                              </div>
                        </div>`;
        });
        document.getElementById('questions').innerHTML = view;
        showMore();

    }


    function showMore() {
        let questions = document.querySelectorAll('.open-question');
        questions.forEach(question => {
            question.addEventListener('click', function () {
                this.classList.toggle('active');
                let desc = this.nextElementSibling;
                let question = this.parentElement;
                if(desc.style.maxHeight){
                    desc.style.maxHeight = null;
                    question.style.height = 100 + 'px';
                } else {
                    desc.style.maxHeight = desc.scrollHeight + 'px';
                    question.style.height = question.scrollHeight + desc.scrollHeight + 'px';
                }
            });
        })
    }

    function addQuestion() {
        let addQuestion = document.getElementById('add-question-btn');
        addQuestion.addEventListener('click', function () {
            let question = prompt('What is your question?', 'What is Linux?');
            let description = prompt('Write down description of your problem', 'Linux is an Operation System');
            let category = prompt('Set category for your question', 'PHP');
            let questions =
                {
                    question: question,
                    description: description,
                    category: category
                }
            db_saveQuestions(questions,'db');
            renderQuestions();
        })
    }

    addQuestion();
    renderQuestions();

})